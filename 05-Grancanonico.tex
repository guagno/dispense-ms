%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{L'\ensemble\ grancanonico}
\label{cap:grancanonico}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Uno dei passi che ci ha portato dal microcanonico al canonico è stato quello di considerare il fatto che l'energia interna di un sistema macroscopico non è direttamente misurabile. La medesima cosa, in realtà, si può dire del numero di particelle che costituiscono lo stesso sistema macroscopico: saranno $10^{23} + 1$ o $10^{23} - 1$? Pur rimanendo vero che cambia poco (e in effetti nel limite termodinamico non cambia nulla: l'\ensemble\ grancanonico (che andremo a definire tra pochissimo), in questo limite, riproduce i risultati dei due \ensembles\ precedenti) tutto quel che al meglio possiamo fare è inferire il numero medio di costituenti elementari si un sistema macroscopico da osservazioni indirette.

Ma c'è di più: in alcune situazioni fisiche (o chimiche) il numero dei costituenti elementari di un sistema macroscopico può cambiare. Si pensi banalmente alla transizione di fase dell'acqua da liquido a vapore; alla transizione abbiamo due sistemi in equilibrio: uno costituito dall'acqua e l'altro da vapor acqueo.

Ma c'è ancora di più: in realtà il formalismo dell'\ensemble\ grancanonico (come vedremo in seguito) rivelerà tutto il suo potere nel caso della statistica quantistica. Seguiamo dunque per il numero $N$ di particelle lo stesso tragitto che abbiamo seguito, nei confronti dell'energia, passando dal microcanonico al canonico: lasciamo che $N$ possa liberamente fluttuare da $0$ a $\infty$. Come nel caso precedente, possiamo vedere la cosa in due modi: o consideriamo il nostro sistema fisico come un sottosistema che può scambiare, con una riserva, sia energia sia particelle, o lo consideriamo come membro di un \ensemble, i cui elementi sono liberi di condividere energia e particelle. Cominciamo col primo punto di vista.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Contatto con una riserva}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Consideriamo dunque il nostro sistema fisico $A$ in contatto con una riserva $A'$. $A$ può scambiare con $A'$ sia energia sia particelle. In ogni caso il numero totale di particelle in $A_0 = A + A'$, e cioè $N_0$, è costante, e così pure l'energia di $A_0$, uguale a $E_0$. Dunque, se in un certo dato istante il sistema $A$ si trova in uno stato con energia $E_r$ e numero di particelle $N_s$, abbiamo due relazioni che devono essere contemporaneamente soddisfatte:
\bea
N_s + N_s' = N_0\nonumber \\
E_r + E_r' = E_0
\eea
Non è difficile a questo punto indovinare che andremo a espandere intorno al caso $E_r \ll E_r'$ e $N_s \ll N_s'$. Ora, esattamente come abbiamo fatto nel caso del formalismo canonico, assumiamo che la probabilità $P_{r,s}$ che il sistema $A$ si trovi in uno stato con energia $E_r$ e numero di particelle $N_s$ sia direttamente proporzionale al numero di microstati $\Omega'(N_s', E_r')$ del sistema $A'$ compatibili con le condizioni poste. Ma
\bea
\ln\Omega'(N_s',E_r') &=& \ln\Omega'(N_0,E_0) \nonumber \\
&+& (N_s'-N_0)\dparc{\ln\Omega'}{N_s'}{N_s'=N_0}
+ (E_r'-E_0)\dparc{\ln\Omega'}{E_r'}{E_r'=E_0} \nonumber \\
&\simeq& \mathrm{cost} - \alpha' N_s - \beta' E_r
\eea
in cui $\alpha' = -\mu'/kT'$ e $\beta' = 1/kT'$. $T'$ e $\mu'$ sono rispettivamente la temperatura e il potenziale chimico del sistema $A'$. Ma all'equilibrio dovremo necessariamente avere $\alpha = \alpha'$ e $T = T'$. Da questa condizione e dall'equazione precedente ricaviamo necessariamente
\be
P_{r,s} \propto \exp(-\alpha N_s -\beta E_r)
\ee
e normalizzando
\be
P_{r,s} = \frac{e^{-\alpha N_s - \beta E_r}}{\sum_{\rho,\sigma}e^{-\alpha N_\sigma - \beta E_\rho}}
\ee

%-----------------------------------------------------------------------
% ENSEMBLE
%-----------------------------------------------------------------------

\section{L'\ensemble\ grancanonico}

Immaginiamo ora $\calN$ sistemi identici. I sistemi hanno in totale un numero di particelle pari a $\calN\aspetta{N}$, e un'energia pari a $\calN U$. Resta inteso che $U$ è l'energia media dei sistemi, che assumeremo essere l'energia interna del nostro sistema fisico originale, e $\aspetta{N}$ il numero medio di particelle. Nel seguito, per non appesantire la notazione, scriveremo sempre $N$ al posto di $\aspetta{N}$, a meno che questo non ingeneri confusione. Dunque da questo punto in poi, salvo avviso contrario, $N$ rappresenta il valore d'aspettazione del numero di particelle del sistema (un'osservabile, quindi) e non più una quantità fissa.
Sia $\nrs$ il numero di elementi dell'\ensemble\ con energia $E_r$ e numero di particelle $N_s$; il nostro \ensemble\ grancanonico è ora sottoposto a tre vincoli:
\bea
\label{eq:condgcan}
\sum_{r,s} \nrs &=& \calN\nonumber \\
\sum_{r,s} N_s\nrs &=& \calN N\nonumber \\
\sum_{r,s} E_r \nrs &=& \calN U
\eea
Qualsiasi insieme $\nrsset$ dei numeri $\nrs$ che soddisfi le condizioni \ref{eq:condgcan} rappresenta uno dei possibili modi di distribuire energia e particelle tra gli elementi dell'\ensemble. Ciascuno di questi modi può essere realizzato in $\Wnrs$ modi, con
\be
\label{eq:wnrs}
\Wnrs = \frac{\calN!}{\prod_{r,s}\nrs!}
\ee
Ora, esattamente come nel caso del canonico, possiamo calcolare la probabilità $P_{r,s}$ di trovare il nostro sistema fisico in uno stato con energia $E_r$ e numero di particelle $N_s$ o tramite il metodo del valore più probabile o tramite il metodo del valor medio (nel secondo caso avremo a che fare con integrali in due variabili complesse). In ogni caso il risultato è lo stesso, e la derivazione così facile che è lasciata come esercizio:
\be
\label{eq:gcp}
P_{r,s} = \lim_{\calN\to\infty}\frac{\aspetta{\nrs}}{\calN} = \frac{e^{-\alpha N_s - \beta E_r}}{\sum_{\rho,\sigma}e^{-\alpha N_\sigma - \beta E_\rho}}
\ee
I parametri $\alpha$ e $\beta$ sono soluzione delle equazioni
\bea
\label{eq:gcnu}
N = \frac{\sum_{r,s} N_s e^{-\alpha N_s - \beta E_r}}{\sum_{r,s} e^{-\alpha N_s - \beta E_r}} =
-\dpar{}{\alpha}\left\{ \ln\sum_{r,s} e^{-\alpha N_s - \beta E_r}  \right\} \nonumber \\
U = \frac{\sum_{r,s} E_r e^{-\alpha N_s - \beta E_r}}{\sum_{r,s} e^{-\alpha N_s - \beta E_r}} =
-\dpar{}{\beta}\left\{ \ln\sum_{r,s} e^{-\alpha N_s - \beta E_r}  \right\}
\eea
con $N$ e $U$ preassegnati.

%-----------------------------------------------------------------------
% SIGNIFICATO
%-----------------------------------------------------------------------

\section{Significato fisico delle quantità statistiche}

Iniziamo con l'introdurre il $q$--potenziale:
\be
q \equiv \ln\sum_{r,s} e^{-\alpha N_s - \beta E_r}
\ee
$q$ è funzione di $\alpha$, di $\beta$ e dei livelli $E_r$. E perché non anche di $N_s$, chiederanno subito i miei piccoli lettori? Il motivo è molto semplice: nell'espressione $\sum_{r,s}$, la somma su $s$ in realtà significa: $\sum_{N_s=0}^\infty$, chiaro? Le quantità $E_r$ possono essere modificate, per esempio, variando il volume; su $N_s$ si somma direttamente sopra, è una variabile {\em dummy}.

Chiarito questo punto, possiamo calcolare il differenziale totale $\de q$. Facendo uso delle (\ref{eq:gcp}, \ref{eq:gcnu}) otteniamo
\be
\label{eq:deqpot}
\de q = -N\de\alpha - U\de\beta - \frac{\beta}{\calN}\sum_{r,s}\aspetta{\nrs}\de E_r
\ee
(dove con $N$, lo scrivo per l'ultima volta, spero, si intende $\aspetta{N}$). 
Per ricavare il terzo dermine nel lato destro della \ref{eq:deqpot} ragioniamo come segue: differenziamo dapprima rispetto a una sola delle $E_r$, ottenendo:
\be
-\beta \frac{e^{-\alpha N_s - \beta E_r}}{\sum{\rho,\sigma -\alpha N_\sigma - \beta E_\rho}}\de{E_r}
\ee
e riconosciamo che la frazione nella precedente è proprio $P_{r,s}$, che possiamo scrivere come $\aspetta{n_{r,s}}/\calN$. Sommando su $r$ e $s$ otteniamo il risultato.

Dalla \ref{eq:deqpot} ricaviamo
\be
\label{eq:preQ}
\de(q + \alpha N + \beta U) = \beta\left( \frac{\alpha}{\beta} + \de U - \frac{1}{\calN}\sum_{r,s}\aspetta{\nrs}\de E_r \right)
\ee
Compariamo quest'ultima equazione con la prima legge della termodinamica:
\be
\delta Q = \de U + \delta W - \mu\de N
\ee
Il differenziale (non esatto) del lavoro può essere scritto come $\delta W = P\de V$, e allo stesso tempo la pressione può essere scritta come
\be
P = -\dparc{U}{V}{S,N}
\ee
Ma
\be
\de U\big|_S = \frac{1}{\calN}\sum_{r,s}\aspetta{\nrs}\de E_r
\ee
perché se $S = \mathrm{costante}$ non devo differenziare le $P_{r,s}$. Il risultato netto è che il membro di destra della \ref{eq:preQ} è $\beta\delta Q$, $\beta$ può essere identificato con $1/kT$ e $\mu = -\alpha/\beta$. Abbiamo quindi
\be
q = \frac{S}{k} - \alpha N - \beta U = \frac{TS + \mu N - U}{kT}
\ee
Ma $\mu N = G = U - TS + PV$, e alla fine troviamo
\be
q \equiv \ln\sum_{r,s} e^{-\alpha N_s - \beta E_r} = \frac{PV}{kT}
\ee
\`E utile a questo punto introdurre la fugacità:
\be
z = e^{\mu/kT}
\ee
In termini della fugacità possiamo scrivere
\be
q = \ln\sum_{r,s} z^{N_s}e^{-\beta E_r} = \ln\sum_{N_s=0}^{\infty}z^{N_s}Q_{N_s}(V,T)\quad\quad(\mathrm{con}\ Q_0=1)
\ee
e possiamo scrivere, introducendo la funzione di granpartizione,
\be
q(z,V,T) = \ln\calQ(z,V,T)
\ee
Da come è stata definita, sembra che per calcolare la funzione di granpartizione di un sistema occorra prima calcolarne la funzione di partizione. In generale, e in linea di principio, questo è vero, ma non sempre. Ci sono situazioni (e lo vedremo quando ci occuperemo dei gas ideali quantistici) in cui calcolare la funzione di partizione è pressoché impossibile mentre risulta più facile calcolare direttamente la funzione di granpartizione. 

Siamo ora in posizione per scrivere la ricetta completa che ci permette di passare dalla meccanica statistica grancanonica alla termodinamica. Abbiamo:
\bea
P(z,V,T) &=& \frac{kT}{V}q(z,V,T) = \frac{kT}{V}\ln\calQ(z,V,T) \label{eq:granCP} \\
N(z,V,T) &=& z\left[ \dpar{}{z}q(z,V,T) \right]_{V,T} = kT\left[ \dpar{}{\mu}q(\mu,V,T) \right]_{V,T} \label{eq:granCN} \\
U(z,V,T) &=& -\left[ \dpar{}{\beta}q(z,V,T) \right]_{z,V} = kT^2\left[ \dpar{}{T}q(z,V,T) \right]_{z,V} \label{eq:granCU}
\eea
Eliminando $z$ tra la \ref{eq:granCP} e la \ref{eq:granCN} otteniamo la relazione che lega pressione, volume, temperatura e numero di particelle, ossia in parole povere l'equazione di stato del sistema. D'altro canto eliminando $z$ tra la \ref{eq:granCN} e la \ref{eq:granCU} otteniamo $U$ come funzione di $N,V,T$, e possiamo facilmente arrivare a $C_V$.

Per l'energia libera di Helmoltz abbiamo
\be
A = \mu N - PV = NkT\ln z - kT\ln\calQ(z,V,T) = -kT\ln\left( \frac{\calQ(z,V,T)}{z^N} \right)
\ee
e per l'entropia
\be
S = \frac{U-A}{T} = kT\dparc{q}{T}{z,V} - Nk\ln z + kq
\ee

%-----------------------------------------------------------------------
% ESEMPI
%-----------------------------------------------------------------------

\section{Esempi}

In questa sezione vedremo un paio di esempi per vedere come funziona il formalismo del $q$-potenziale. Non sono dimostrazioni della potenza del metodo: quella verrà fuori naturalmente quando ci occuperemo della statistica quantistica.

Cominciamo dal padre di tutti gli esempi, il gas ideale classico. Ricordiamo che per la funzione di partizione possiamo scrivere
\be
Q_N(V,T) = \frac{[Q_1(V,T)]^N}{N!}
\ee
in cui $Q_1$ è la funzione di partizione di singola particella. In linea del tutto generale possiamo scrivere
\be
Q_1(V,T) = Vf(T)
\ee
in cui $f(T)$ è funzione della sola temperatura. Abbiamo quindi, per la funzione di granpartizione,
\be
\calQ(z,V,T) = \sum_{M} z^M Q_M = \sum_{M}\frac{[zVf(T)]^M}{M!} = e^{zVf(T)}
\ee
che fornisce subito
\be
q(z,V,T) = zVf(T)
\ee
Utilizzando le formule della sezione precedente otteniamo subito
\bea
P &=& \phantom{-} zkTf(T) \label{eq:gcgiP} \\
N &=& \phantom{-} zVf(T)  \label{eq:gcgiN} \\
U &=& \phantom{-} zVkT^2f'(T) \label{eq:gcgiU} \\
A &=& \phantom{-} NkT\ln z - zVkTf(T) \label{eq:gcgiA} \\
S &=& -Nk\ln z + zVk[Tf'(T) + f(T)] \label{eq:gcgiS}
\eea
Eliminando $z$ tra la \ref{eq:gcgiP} e la \ref{eq:gcgiN} otteniamo l'equazione di stato: $PV = NkT$. Notiamo che questa relazione vale per qualsiasi $f(T)$ che sia funzione della sola temperatura. Per l'energia interna abbiamo
\be
U = NkT^2f'(T)/f(T)
\ee
che ci permette di scrivere subito
\be
C_V = Nk\frac{2Tf(T)f'(T) + T^2\{f(T)f''(T)-[f'(T)]^2\}}{[f(T)]^2}
\ee
In molti casi $f(T)$ è proporzionale a una certa potenza della temperatura: $f(T) = cT^n$. Quindi avremo
\be
U = n(NkT)\quad\quad\quad C_V = n(Nk)
\ee
Il prossimo esempio riguarda un sistema di particelle localizzate (si pensi a un sistema di oscillatori armonici) non interagenti. In questo caso possiamo scrivere
\be
Q_N(V,T) = [Q_1(V,T)]^N \equiv [\phi(T)]^N
\ee
perché abbiamo visto che per sistemi del genere la funzione di partizione di singola particella non può dipendere dal volume. Otteniamo dunque
\be
\calQ(z,V,T) = \sum_{M}[z\phi(T)]^M = \frac{1}{1-z\phi(T)}
\ee
in cui è chiaro che la quantità $z\phi(T)$ deve essere minore di $1$, altrimenti la serie non converge. Cominciando dalla pressione, vediamo che
\be
P = \frac{kT}{V}q(z,T) = -\frac{kT}{V}\ln[1-z\phi(T)]
\ee
e poiché sia $z$ sia $T$ sono quantità intensive, la pressione va a zero nel limite termodinamico (ma vedi dopo). Otteniamo poi:
\bea
N &=& \phantom{-} \frac{z\phi(T)}{1-z\phi(T)} \label{eq:gcoaN} \\
U &=& \phantom{-} \frac{zkT^2\phi'(T)}{1-z\phi(T)} \label{eq:gcoaU} \\
A &=& \phantom{-} NkT\ln z + kT\ln[1-z\phi(T)] \label{eq:gcoaA} \\
S &=& -Nk\ln z - k\ln[1-z\phi(T)] + \frac{zkT\phi'(T)}{1-z\phi(T)} \label{eq:gcoaS}
\eea
Dalla \ref{eq:gcoaN} otteniamo
\be
z\phi(T) = \frac{N}{N+1} \simeq 1 - \frac{1}{N}\quad\quad(N\gg 1)
\ee
da cui si vede che la condizione $z\phi(T) < 1$ è, sia pure di un soffio che svanisce nel limite termodinamico, soddisfatta. L'equazione precedente ci dice anche che la pressione, nel limite termodinamico, svanisce come $\ln(N)/N$, perché
\be
1-z\phi(T) = \frac{1}{N+1} \simeq \frac{1}{N}
\ee
L'eliminazione di $z$ dalle altre equazioni ci permette di scrivere
\bea
\frac{U}{N}  &=& \phantom{-} \frac{kT^2\phi'(T)}{\phi(T)} \\
\frac{A}{N}  &=& -kT\ln\phi(T) + O\left( \frac{\ln N}{N} \right) \\
\frac{S}{Nk} &=& \phantom{-}\ln\phi(T) + T\phi'(T) + O\left( \frac{\ln N}{N} \right)
\eea

%-----------------------------------------------------------------------
% EQUILIBRIO SOLIDO-VAPORE
%-----------------------------------------------------------------------

\subsection{Equilibrio solido--vapore}

Come corollario dei due esempi precedenti consideriamo il problema dell'equilibrio solido--vapore. Abbiamo dunque un sistema fisico con un singolo componente elementare ma diviso in due fasi, una solida e una di vapore, all'equilibrio a temperatura $T$. Il tutto è racchiuso in un contenitore di volume $V$. Le due fasi sono libere di scambiarsi particelle, e dunque la condizione di equilibrio indica che i potenziali chimici nelle due fasi devono essere uguali. Avremo dunque
\be
z_g = \frac{N_g}{V_gf(T)}
\ee
per la fase gassosa, e
\be
z_s \simeq \frac{1}{\phi(T)}
\ee
per la fase solida. Uguagliando le ultime due otteniamo, per la densità della fase di vapore
\be
\label{eq:cfs}
N_g/V = f(T)/phi(T)
\ee
in cui abbiamo posto $V_g\simeq V$. Se la densità nella fase di vapore non è troppo elevata possiamo considerare il gas come un gas ideale monoatomico: quindi
\be
f(T) = \left(\frac{2\pi mkT}{h^2}\right)^{3/2}
\ee
mentre possiamo approssimare la fase solida come un set di oscillatori armonici tridimensionali caratterizzati da una singola frequenza $\omega$ (modello di Einstein): dunque
\be
\phi(T) = [2\sinh(\hbar\omega/2kT)]^{-3}
\ee
Tuttavia, per una corretta comparazione tra la funzione $f(T)$ e $\phi(T)$, occorre tenere presente che un atomo in un solido è energeticamente più stabile di un atomo libero --- questo perché occorre fornire energia al solido per far evaporare gli atomi. Sia $\epsilon$ il valore di questa soglia energetica (per atomo). A questo punto possiamo scrivere, per la pressione di vapore all'equilibrio,
\be
P = \frac{N_g}{V}kT = kT \frac{f(T)}{\phi(T)}e^{-\epsilon/kT}
\ee
Notiamo che la \ref{eq:cfs} fornisce la condizione necesaria per la formazione della fase solida. La condizione chiaramente è
\be
N > V\frac{f(T)}{\phi(T)}
\ee
in cui $N$ è il numero totale di atomi nel sistema. Alternativamente possiamo pensare che esista una temperatura critica, $T_c$, determinata dalla relazione
\be
\frac{f(T_c)}{\phi(T_c)} = \frac{N}{V}
\ee

%-----------------------------------------------------------------------
% FLUTTUAZIONI
%-----------------------------------------------------------------------

\section{Fluttuazioni}

Per stabilire l'eventuale corrispondenza con gli altri due \ensembles\ dovremo tener conto, questa volta, non solo delle fluttuazioni dell'energia ma anche del numero di particelle. In questa sezione reintroduciamo momentaneamente la notazione $\aspetta{N}$ per indicare il numero medio di particelle nel sistema.

Ricordando che
\be
\aspetta{N} = \frac{\sum_{r,s}N_s e^{-\alpha N_s -\beta E_r}}{\sum_{r,s}e^{-\alpha N_s -\beta E_r}}
\ee
vediamo subito che
\be
\aspetta{(\Delta N)^2} \equiv \aspetta{N^2} - \aspetta{N}^2 = -\dparc{\aspetta{N}}{\alpha}{T,V} = kT\dparc{\aspetta{N}}{\mu}{T,V}
\ee
Dalla precedente otteniamo, per le fluttuazioni della densità di particelle $\aspetta{n} = \aspetta{N}/V$,
\be
\frac{\aspetta{(\Delta n)^2}}{\aspetta{n}^2} = \frac{\aspetta{(\Delta N)^2}}{\aspetta{N}^2} = \frac{kT}{\aspetta{N}^2}\dparc{\aspetta{N}}{\mu}{T,V}
\ee
In termini della quantità $v = 1/\aspetta{n}$ possiamo scrivere
\be
\frac{\aspetta{(\Delta n)^2}}{\aspetta{n}^2} = \frac{kTv^2}{V^2}\dparc{(V/v)}{\mu}{T,V} = -\frac{kT}{V}\dparc{v}{\mu}{T}
\ee
Per scrivere il risultato in forma più pratica ricordiamo la relazione termodinamica
\be
\de\mu = v\de P - s\de T
\ee
per cui a $T$ costante $\de\mu = v\de P$. Dunque
\be
\label{eq:fluttNGran}
\frac{\aspetta{(\Delta n)^2}}{\aspetta{n}^2} = -\frac{kT}{V}\left[\frac{1}{v}\dparc{v}{P}{T} \right] \equiv \frac{kT}{V}\kappa_T
\ee
in cui $\kappa_T$ è la compressibilità isoterma del sistema. Otteniamo un risultato importante: ordinariamente abbiamo che le fluttuazioni quadratiche medie nella densità sono $O(N^{-1/2})$ e dunque completamente trascurabili nel limite termodinamico; esistono però eccezioni a questa situazione, in particolare durante le transizioni di fase. In queste situazioni la compressibilità isoterma di un sistema può diventare enorme, e al limite divergere al punto critico. Per esempio sperimentalmente si trova, per il punto critico liquido--vapore, $\kappa_T(T_c) \sim N^{0.63}$. Quindi le fluttuazioni crescono più rapidamente di $N^{1/2}$, e vanno come $N^{0.82}$. Nella regione di transizione, e specialmente al punto critico, potremo osservare grandi fluttuazioni nella densità. Risulta chiaro che in queste situazioni i tre ensemble non possono dare gli stessi risultati: il formalismo corretto da usare è quello del grancanonico.

Esaminiamo ora le fluttuazioni dell'energia (ristabiliamo la notazione per cui il valore d'aspettazione del numero di particelle è scritto semplicemente $N$). Con l'usuale procedura otteniamo
\be
\label{eq:primafgc}
\aspetta{(\Delta E)^2} = \aspetta{E^2} - \aspetta{E}^2 = -\dparc{U}{\beta}{z,V} = kT^2\dparc{U}{T}{z,V}
\ee
Abbiamo
\be
\label{eq:secondafgc}
\dparc{U}{T}{z,V} = \dparc{U}{T}{N,V} + \dparc{U}{N}{T,V}\dparc{N}{T}{z,V}
\ee
Considerando che
\be
N = -\dparc{\ln\calQ}{\alpha}{\beta,V} \quad\quad\quad U = -\dparc{\ln\calQ}{\beta}{\alpha,V}
\ee
abbiamo
\be
\dparc{N}{\beta}{\alpha,V} = \dparc{U}{\alpha}{\beta,V}
\ee
e quindi
\be
\label{eq:terzafgc}
\dparc{N}{T}{z,V} = \frac{1}{T}\dparc{U}{\mu}{T,V}
\ee
Sostituendo la \ref{eq:secondafgc} e la \ref{eq:terzafgc} nella \ref{eq:primafgc} otteniamo
\be
\aspetta{(\Delta E)^2} = kT^2C_V + kT\dparc{U}{N}{T,V}\dparc{U}{\mu}{T,V}
\ee
e usando la {\em chain rule} otteniamo finalmente
\be
\aspetta{(\Delta E)^2} = \aspetta{(\Delta E)^2}_{\mathrm{can}} + 
\left\{
\dparc{U}{N}{T,V}
\right\}^2 \aspetta{(\Delta N)^2}
\ee
Vediamo dunque che le fluttuazioni di energia del grancanonico sono composte dalla somma della stessa espressione canonica più un termine che dipende dalla fluttuazione del numero di particelle.	

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ritorno sul potenziale esterno}
\label{sec:05-potesternoGC}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Nella sezione \ref{sec:potesterno} del capitolo \ref{cap:canonico} abbiamo studiato il gas ideale classico in presenza di un potenziale esterno, in particolare di una forza gravitazionale costante. In questa sezione riprendiamo il problema per mostrare come il formalismo grancanonico ci permetta di arrivare facilmente a esprimere la pressione in funzione dell'altezza. Ricapitoliamo le condizioni che deve soddisfare il potenziale esterno:
\begin{itemize}
\item dev'essere indipendente dal tempo;
\item deve variare lentamente sulla scala delle distanze tipiche tra le particelle e delle eventuali interazioni microscopiche;
\item non deve modificare in maniera sostanziale le eventuali interazioni intermolecolari (esempio: un forte campo elettrico applicato a molecole facilmente polarizzabili)
\end{itemize}
Sotto queste condizioni possiamo immaginare di isolare, all'interno del nostro sistema, un sottosistema intorno alla coordinata $\myvec{r}$ tale che il potenziale $U(\myvec{r})$ possa essere considerato sostanzialmente costante all'interno del sottosistema, anche se il sottosistema stesso è da intendersi come macroscopico a tutti gli effetti pratici. Nel caso del gas in un cilindro possiamo pensare a un cilindretto posto a quota $y$, di altezza $\de{y}$ e la cui base sia parallela alla base del cilindro. All'interno di questo sottosistema possiamo considerare il potenziale gravitazionale come costante e pari a $mgy$.

Nel capitolo \ref{cap:canonico} abbiamo scoperto che la funzione di partizione di {\em singola particella} per un gas ideale classico è
\be
Q_1 = V/\lambda^3
\ee
in cui $\lambda$ è la lunghezza d'onda termica. Invece in questo capitolo abbiamo visto che il $q$--potenziale del sistema è
\be
q(z,V,T) = \ln\calQ(z,V,T) = zV/\lambda^3
\ee
in cui la $z = e^{\mu/kT}$. Per il gas ideale classico possiamo quindi scrivere
\be
q(z,V,T) = zQ_1
\ee 
D'altronde per il numero medio di particelle $N$ abbiamo
\be
\label{eq:conGC0}
N = z\left[ \dpar{}{z}q(z,V,T) \right]_{V,T} = zQ_1
\ee
Nessuno però può negarci il diritto di scrivere
\be
\label{eq:conGC1}
Q_1 = \sum_\varepsilon e^{-\beta\varepsilon}
\ee
in cui la somma è su tutti i livelli di energia di singola particella del sistema. Possiamo però anche scrivere
\be
\label{eq:conGC2}
N = \sum_\varepsilon \langle n_\varepsilon\rangle
\ee
nella quale $\langle n_\varepsilon\rangle$ rappresenta il valore d'aspettazione del numero di particelle sul livello d'energia $\varepsilon$.

Confrontando la (\ref{eq:conGC0}) con la (\ref{eq:conGC2}) e usando la (\ref{eq:conGC1}) otteniamo, per un gas ideale classico,
\be
\langle n_\varepsilon\rangle = e^{(\mu-\varepsilon)/kT}
\ee
Questo risultato, che andremo presto a utilizzare per l'obiettivo che ci siamo posti in questa sezione, risulterà utile anche in futuro, quando dovremo confrontare la stessa quantità, ma calcolata usando un formalismo completamente quantistico, quindi quando studieremo gas ideali di Bose--Einstein o di Fermi--Dirac.

La presenza di un potenziale esterno cambia le carte in tavola. Da una parte abbiamo che il potenziale chimico del sistema in equilibrio non può che essere costante, perché all'equilibrio non possiamo ammettere spostamenti netti di materia da una parte all'altra del sistema. Dall'altra, insistendo a chiamare $\varepsilon$ solo la parte cinetica dell'energia di una molecola, dobbiamo scrivere
\be
\langle n_\varepsilon\rangle = e^{[(\mu-mgy) - \varepsilon]/kT}
\ee
Possiamo dunque pensare al sistema con un campo esterno come a un sistema {\em senza} campo esterno ma con un {\em potenziale chimico effettivo}
\be
\mu_{\textrm{eff}}(y) = \mu - mgy
\ee
che dipende dalle coordinate. La variazione di $\mu_{\textrm{eff}}$ con $y$ è costruita in modo tale da generare una densità {\em dipendente dalla posizione} che mantiene il sistema all'equilibrio.

Per un gas ideale classico, la relazione che lega il potenziale chimico alla densità è
\be
\mu = kT\ln(n\lambda^3)
\ee
Nelle condizioni imposte dall'esistenza del potenziale gravitazionale, nelle quali la densità $n$ dipende necessariamente dalle coordinate, dobbiamo invece scrivere
\be
\mu_{\textrm{eff}}(y) = \mu - mgy = kT\ln(n(y)\lambda^3)
\ee
Poiché stiamo studiando un sottostistema (macroscopico) all'equilibrio a temperatura $T$, l'equazione di stato dei gas ideali continua a essere valida, e possiamo scrivere
\be
\mu - mgy = kT\ln\left(\dfrac{P(y)\lambda^3}{kT}\right)
\ee
e derivando rispetto a $y$, considerando che $\mu$ è constante, otteniamo
\be
\dfrac{\de{P(y)}}{P(y)} = -\dfrac{mg}{kT}\de{y}
\ee
che integrata ci dà facilmente
\be
P(y) = P(0)e^{-mgy/kT}
\ee
La precedente è la {\em formula barometrica dell'atmosfera isoterma}, ottenuta per la prima volta da Boltzmann (con un metodo completamente diverso).

Sostituendo $y = L$ in questa equazione e normalizzando correttamente (tutto ciò è lasciato come esercizio) otteniamo, per la pressione sulla faccia superiore del cilindro, la stessa espressione che avevamo ottenuto in precedenza, eq. (\ref{eq:PaL}).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Esercizi per il capitolo \ref{cap:grancanonico}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{Exercise}[title={Equivalenza tra \ensembles},label={ex:eqcgc}]
\noindent
Si consideri un gas ideale classico composto da $N$ particelle {\em distinguibili}. Si calcolino l'energia libera di Helmholtz $A$, l'energia interna $U$ e l'entropia $S$ in termini di $Q_1$ (funzione di partizione di singola particella), sia nel canonico ($C$) sia nel grancanonico ($G$). Si verifichi che $U_G = U_C$, e che nel limite termodinamico vale la relazione
\be
\frac{S_G-S_C}{Nk} = -\frac{A_G-A_C}{NkT} \simeq \frac{\ln N}{N}
\ee
\end{Exercise}

\begin{Exercise}[title={Scatola a sorpresa},label={es:sas}]
\noindent
Si consideri una scatola di volume $V$ in cui è contenuto un gas ideale classico composto da $N$ molecole monoatomiche. Le pareti del contenitore hanno $N_0$ centri di assorbimento; ognuno di questi centri può ospitare al massimo una molecola di gas. Nel caso in cui la molecola venga assorbita, assume un'energia pari a $-\epsilon$. Si calcoli, all'equilibrio termico a temperatura $T$, la fugacità del gas in funzione di pressione $P$ e temperatura $T$. Si calcoli il numero medio $\aspetta{N}$ di molecole assorbite e si discutano i limiti di pressione piccola e grande.
\end{Exercise}

